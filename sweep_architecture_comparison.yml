# W&B Sweep Configuration - Final Optimized ResNet34
# Based on sweep analysis: ResNet34 + batch_size=512 + max_lr=5e-4 achieved 47.25%
# Tighter parameter search around best configurations with longer training

program: src/train_constellation.py
method: bayes  # Continue Bayesian optimization for final tuning
project: modulation-classification

# Tighter parameters focused on top performing configurations
parameters:
  # Model - ResNet34 clearly dominates (47.25% vs 46.15% for ResNet18)
  model_type:
    value: resnet34  # Fixed to best architecture
  
  # SNR layer - bottleneck_64 slightly better in best run (47.25%)
  snr_layer_config:
    values: [bottleneck_64, bottleneck_128]  # bottleneck_64 first
  
  # Batch size - 512 optimal (used in 2/3 top runs)
  batch_size:
    values: [512, 768]  # Focus on 512, test 768 as intermediate
  
  # Dropout - fixed to universal best
  dropout:
    value: 0.5
  
  # Learning rates - tighter range around best performers
  base_lr:
    values: [1e-5, 5e-5]  # Best runs used 1e-5
  
  max_lr:
    values: [5e-4, 1e-3]  # 5e-4 dominated top runs, test slightly higher
  
  # Weight decay - focus on top values
  weight_decay:
    values: [1e-5, 1e-4]  # Remove 1e-3 (caused crashes)
  
  # Pretrained - true dominated top runs
  use_pretrained:
    value: true  # Fixed to best
  
  # Extended training for better convergence
  epochs:
    value: 100  # Double from 50 to allow full convergence
  
  patience:
    value: 10  # Double patience for longer runs
  
  # Fixed SNR range
  snr_list:
    value: "0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30"

# Sweep metadata
name: "final_resnet34_optimization"
description: "Final optimization sweep focused on ResNet34 with proven best hyperparameters. Batch size 512, max_lr around 5e-4, extended to 100 epochs for full convergence. Target: >47.25% accuracy."

# Patient early termination for longer runs
early_terminate:
  type: hyperband
  min_iter: 15     # Much longer minimum (was 8)
  max_iter: 100    # Full training allowed
  s: 3             # Even less aggressive
  eta: 2           # Gentler halving

# Track best validation accuracy
metric:
  name: val_combined_accuracy
  goal: maximize